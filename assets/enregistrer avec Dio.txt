ðŸ“„ Code complet :
dart
Copier
Modifier
import 'dart:io';
import 'dart:typed_data';
import 'package:flutter/material.dart';
import 'package:path_provider/path_provider.dart';
import 'package:permission_handler/permission_handler.dart';
import 'package:flutter/services.dart';
import 'package:flutter/foundation.dart';
import 'package:gallery_saver/gallery_saver.dart'; // optionnel pour MediaScanner

Future<void> saveImageToGallery(Uint8List imageBytes, BuildContext context) async {
  // Demander la permission d'Ã©criture
  final status = await Permission.storage.request();
  if (!status.isGranted) {
    ScaffoldMessenger.of(context).showSnackBar(
      const SnackBar(content: Text("Permission refusÃ©e")),
    );
    return;
  }

  // Obtenir le dossier Pictures/YourApp
  final Directory? extDir = await getExternalStorageDirectory(); // /storage/emulated/0/Android/data/...
  final String dirPath = '${extDir!.parent.parent.parent.parent.path}/Pictures/QRApp';
  final Directory dir = Directory(dirPath);
  if (!await dir.exists()) {
    await dir.create(recursive: true);
  }

  // Enregistrer l'image
  final String filePath = '$dirPath/qr_${DateTime.now().millisecondsSinceEpoch}.png';
  final File file = File(filePath);
  await file.writeAsBytes(imageBytes);

  // Facultatif : dÃ©clenche un scan mÃ©dia pour rendre visible dans la galerie
  // Si tu ne veux pas utiliser un plugin pour Ã§a, ce code est suffisant Ã  partir dâ€™Android 11
  if (Platform.isAndroid) {
    final result = await Process.run(
      'am', ['broadcast', '-a', 'android.intent.action.MEDIA_SCANNER_SCAN_FILE', '-d', 'file://$filePath'],
    );
    debugPrint('Scan Media: ${result.stdout}');
  }

  ScaffoldMessenger.of(context).showSnackBar(
    const SnackBar(content: Text('QR Code sauvegardÃ© dans le dossier Pictures/QRApp')),
  );
}
ðŸ“Œ Utilisation :
dart
Copier
Modifier
final image = await screenshotController.capture();
if (image != null) {
  await saveImageToGallery(image, context);
}
Souhaites-tu une version plus propre compatible Android 13/14 ou un exemple de scan sans plugin ?








